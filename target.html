<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REPORT M114 - PREMIUM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        @keyframes gradientMove {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .animated-bg {
            background: linear-gradient(-45deg, #1e293b, #960000, #06b6d4, #4f46e5);
            background-size: 400% 400%;
            animation: gradientMove 10s ease infinite;
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
    </style>
</head>

<body class="animated-bg min-h-screen font-sans text-slate-800">

<header class="glass-panel shadow-lg sticky top-0 z-50">
    <div class="max-w-6xl mx-auto p-4 flex justify-between items-center">
        <h1 class="font-black text-2xl tracking-tighter text-slate-900 uppercase italic">M114 <span class="text-red-600">Report</span></h1>
        <div class="text-xs font-bold bg-black/10 px-3 py-1 rounded-full tracking-widest uppercase">Live Updates</div>
    </div>
</header>

<main class="max-w-6xl mx-auto p-4 lg:p-8">

    <div class="relative max-w-2xl mx-auto mb-10">
        <i class="fa-solid fa-magnifying-glass absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"></i>
        <input id="search" placeholder="Cari nama toko, brand, atau leasing..."
            class="bg-white/95 w-full p-4 pl-12 rounded-2xl shadow-xl focus:outline-none focus:ring-4 focus:ring-red-500/20 transition-all border-none text-lg"
            oninput="filterItems()" />
    </div>

    <div id="content-area" class="space-y-12 pb-20">
        </div>

    <div class="fixed bottom-6 left-1/2 -translate-x-1/2 z-50">
        <button onclick="window.location.href='index.html'" class="px-8 py-3 bg-slate-900 text-white rounded-full font-bold shadow-2xl hover:bg-black hover:-translate-y-1 transition-all active:scale-95 flex items-center gap-2">
            <i class="fa-solid fa-arrow-left"></i> Kembali ke Dashboard
        </button>
    </div>

</main>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/1UMVGCANWjOQlwGFzi47POm7dVEtYOmAq4jz7O2rol5o/export?format=tsv";

const config = {
    STORE: { color: "bg-blue-600", border: "border-blue-500", icon: "fa-store" },
    ERO: { color: "bg-emerald-600", border: "border-emerald-500", icon: "fa-user-tie" },
    PROMOTOR: { color: "bg-amber-500", border: "border-amber-500", icon: "fa-tags" },
    FINANCING: { color: "bg-purple-600", border: "border-purple-600", icon: "fa-hand-holding-dollar" }
};

function filterItems(){
    const q = document.getElementById("search").value.toLowerCase();
    document.querySelectorAll(".data-row, .mobile-card").forEach(el => {
        el.style.display = el.innerText.toLowerCase().includes(q) ? "" : "none";
    });
}

fetch(CSV_URL)
.then(r => r.text())
.then(text => {
    const lines = text.split("\n").map(l => l.trim()).filter(Boolean);
    let mode = "";
    const area = document.getElementById("content-area");

    // Inisialisasi Section
    Object.keys(config).forEach(key => {
        area.innerHTML += `
            <div id="container-${key}" class="hidden">
                <h2 class="flex items-center gap-3 font-black text-2xl mb-5 text-white drop-shadow-lg uppercase tracking-tight">
                    <i class="fa-solid ${config[key].icon} p-2 bg-white/20 rounded-lg text-sm"></i> ${key}
                </h2>
                <div class="hidden md:block overflow-hidden rounded-2xl shadow-2xl bg-white/60 backdrop-blur-md mb-6">
                    <table class="w-full text-left">
                        <thead>
                            <tr class="${config[key].color} text-white text-[10px] uppercase tracking-widest">
                                <th class="p-4">${key}</th>
                                <th class="p-4">TARGET</th>
                                ${key !== 'FINANCING' ? '<th class="p-4 text-center">QTY</th>' : ''}
                                <th class="p-4">VALUE</th>
                                <th class="p-4">TGT/DAY</th>
                                <th class="p-4 text-center italic">ACV/AV</th>
                            </tr>
                        </thead>
                        <tbody id="table-${key}" class="divide-y divide-black/5"></tbody>
                    </table>
                </div>
                <div id="mobile-${key}" class="md:hidden grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
            </div>`;
    });

    lines.forEach(line => {
        const c = line.split("\t");
        const key = c[0]?.toUpperCase();

        if(config[key]) { 
            mode = key; 
            document.getElementById(`container-${key}`).classList.remove("hidden");
            return; 
        }
        if(!mode || c.length < 3 || c[0].toLowerCase().includes("target")) return;

        const table = document.getElementById(`table-${mode}`);
        const mobile = document.getElementById(`mobile-${mode}`);

        // Mapping Kolom Berdasarkan Gambar User
        // STORE/ERO/PROMOTOR: [0]=Nama, [1]=Target, [2]=Qty, [3]=Value, [4]=TgtDay, [5]=ACV
        // FINANCING: [0]=Nama, [1]=Target, [2]=Value, [3]=TgtDay, [4]=ACV
        
        const isFin = (mode === 'FINANCING');
        const data = {
            name: c[0],
            target: c[1],
            qty: isFin ? null : c[2],
            value: isFin ? c[2] : c[3],
            tgtDay: isFin ? c[3] : c[4],
            acv: isFin ? c[4] : c[5]
        };

        const badgeColor = (parseInt(data.acv) >= 100) ? 'bg-emerald-100 text-emerald-700' : 
                           (parseInt(data.acv) >= 50) ? 'bg-sky-100 text-sky-700' : 'bg-rose-100 text-rose-700';

        // Render Desktop Row
        table.innerHTML += `
            <tr class="data-row hover:bg-white/40 transition-colors text-sm">
                <td class="p-4 font-bold text-slate-900 border-l-4 ${config[mode].border.replace('border-', 'border-l-')}">${data.name}</td>
                <td class="p-4 text-slate-600 font-mono text-xs">${data.target}</td>
                ${!isFin ? `<td class="p-4 text-center font-bold text-slate-700">${data.qty}</td>` : ''}
                <td class="p-4 font-black text-slate-800">${data.value}</td>
                <td class="p-4 text-slate-500 italic text-xs">${data.tgtDay}</td>
                <td class="p-4 text-center">
                    <span class="px-3 py-1 rounded-lg text-[10px] font-black ${badgeColor}">${data.acv}</span>
                </td>
            </tr>`;

        // Render Mobile Card
        mobile.innerHTML += `
            <div class="mobile-card glass-panel rounded-2xl p-4 shadow-xl border-t-4 ${config[mode].border}">
                <div class="flex justify-between items-start mb-3">
                    <div class="font-black text-slate-900 truncate pr-2">${data.name}</div>
                    <span class="px-2 py-1 rounded text-[10px] font-black ${badgeColor}">${data.acv}</span>
                </div>
                <div class="grid grid-cols-2 gap-2 text-[10px]">
                    <div class="bg-black/5 p-2 rounded-lg">
                        <div class="text-slate-400 uppercase font-bold">Target</div>
                        <div class="font-bold">${data.target}</div>
                    </div>
                    ${!isFin ? `
                    <div class="bg-black/5 p-2 rounded-lg text-center">
                        <div class="text-slate-400 uppercase font-bold">Qty</div>
                        <div class="font-bold text-lg text-slate-700">${data.qty}</div>
                    </div>` : ''}
                    <div class="col-span-2 bg-black/5 p-2 px-3 rounded-lg flex justify-between items-center">
                        <span class="text-slate-400 uppercase font-bold italic">Value Achievement</span>
                        <span class="font-black text-slate-800 text-sm">${data.value}</span>
                    </div>
                    <div class="col-span-2 text-center text-slate-400 italic pt-1 border-t border-black/5">
                        Tgt/Day: ${data.tgtDay}
                    </div>
                </div>
            </div>`;
    });
});
</script>

</body>
</html>
